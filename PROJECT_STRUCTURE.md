# Структура проекта

```
C:\Poly\Price_logger\
│
├── 📄 price_monitor_service.py      # Основной сервис (рекомендуется)
├── 📄 polymarket_price_logger.py    # Простой скрипт для одного рынка
├── 📄 config.json                   # Конфигурация сервиса
├── 📄 config.example.json           # Пример конфигурации
│
├── 📄 start_service.bat             # Запуск сервиса (Windows)
├── 📄 run_logger.py                 # Простой запуск для одного рынка
├── 📄 example.py                    # Пример использования
│
├── 📄 requirements.txt              # Зависимости Python
│
├── 📖 README.md                     # Основная документация
├── 📖 SERVICE_GUIDE.md              # Подробное руководство по сервису
├── 📖 TROUBLESHOOTING.md            # Решение проблем
├── 📖 PROJECT_STRUCTURE.md          # Этот файл
│
├── 📁 logs/                         # Директория с логами (создается автоматически)
│   ├── market-slug_2026-01-18.json
│   ├── market-slug_2026-01-19.json
│   └── ...
│
└── 📄 .gitignore                    # Игнорируемые файлы для Git

```

## Описание файлов

### Основные файлы

#### `price_monitor_service.py` ⭐
Главный сервис для непрерывного мониторинга.

**Функции:**
- Мониторинг нескольких рынков одновременно
- Горячая перезагрузка конфигурации
- Многопоточность
- Автоматическая ротация файлов по дням
- Обработка ошибок и переподключение

**Использование:**
```bash
python price_monitor_service.py
```

#### `polymarket_price_logger.py`
Простая библиотека для мониторинга одного рынка.

**Использование:**
```python
from polymarket_price_logger import log_market_prices

log_market_prices(
    market_id="market-slug",
    duration_minutes=60,
    log_file="prices.json"
)
```

### Конфигурация

#### `config.json`
Основной файл конфигурации для сервиса.

**Структура:**
```json
{
  "markets": [...],     // Список рынков
  "settings": {...}     // Настройки сервиса
}
```

#### `config.example.json`
Пример конфигурации с комментариями и шаблонами.

### Скрипты запуска

#### `start_service.bat` (Windows)
Batch-файл для запуска сервиса на Windows с правильной кодировкой.

#### `run_logger.py`
Простой скрипт для быстрого запуска мониторинга одного рынка без конфигурации.

#### `example.py`
Примеры использования библиотеки `polymarket_price_logger`.

### Документация

#### `README.md`
Основная документация проекта с кратким описанием и быстрым стартом.

#### `SERVICE_GUIDE.md`
Подробное руководство по работе с сервисом:
- Детальная конфигурация
- Примеры использования
- Горячая перезагрузка
- Запуск как системная служба
- FAQ

#### `TROUBLESHOOTING.md`
База знаний по решению проблем:
- Типичные ошибки и их решения
- Проблемы с API
- Проблемы с кодировкой
- Отладка

#### `PROJECT_STRUCTURE.md`
Описание структуры проекта (этот файл).

### Зависимости

#### `requirements.txt`
Список зависимостей Python:
```
requests>=2.31.0
```

### Данные

#### `logs/`
Директория с данными о ценах. Создается автоматически.

**Формат файлов:**
- Один файл = один рынок + один день
- Формат: `{market-slug}_{YYYY-MM-DD}.json`
- Содержимое: массив JSON объектов с данными о ценах

**Пример:**
```
logs/
├── will-joo-cotrim-figueiredo-win-2026-01-18.json
├── will-joo-cotrim-figueiredo-win-2026-01-19.json
└── another-market-slug_2026-01-18.json
```

## Workflow использования

### Сценарий 1: Непрерывный мониторинг (рекомендуется)

1. Настроить `config.json`
2. Запустить `python price_monitor_service.py`
3. Добавить/удалить рынки в `config.json` без остановки
4. Данные сохраняются в `logs/`

### Сценарий 2: Разовый мониторинг

1. Отредактировать `run_logger.py`
2. Запустить `python run_logger.py`
3. Остановить через Ctrl+C когда нужно
4. Данные в указанном JSON файле

### Сценарий 3: Программное использование

```python
from polymarket_price_logger import log_market_prices

# Ваш код
log_market_prices(...)
```

## Архитектура сервиса

```
┌─────────────────────────────────────────────────┐
│         price_monitor_service.py                │
│                                                 │
│  ┌───────────────────────────────────────┐     │
│  │     Config Reloader Thread            │     │
│  │  (проверяет config.json каждые 30с)   │     │
│  └───────────────────────────────────────┘     │
│                    │                            │
│                    ▼                            │
│  ┌───────────────────────────────────────┐     │
│  │      Main Thread                      │     │
│  │  - Загрузка конфигурации              │     │
│  │  - Запуск/остановка мониторов         │     │
│  │  - Координация потоков                │     │
│  └───────────────────────────────────────┘     │
│                    │                            │
│       ┌────────────┼────────────┐               │
│       ▼            ▼            ▼               │
│  ┌────────┐  ┌────────┐  ┌────────┐            │
│  │Monitor │  │Monitor │  │Monitor │            │
│  │Thread 1│  │Thread 2│  │Thread 3│            │
│  │        │  │        │  │        │            │
│  │Market A│  │Market B│  │Market C│            │
│  └────────┘  └────────┘  └────────┘            │
│       │            │            │               │
│       ▼            ▼            ▼               │
│  ┌────────────────────────────────┐            │
│  │     Polymarket API             │            │
│  │  - Gamma API (market info)     │            │
│  │  - CLOB API (prices)           │            │
│  └────────────────────────────────┘            │
│                    │                            │
│                    ▼                            │
│  ┌────────────────────────────────────────┐    │
│  │        Log Files (JSON)                │    │
│  │  logs/market-a_2026-01-18.json         │    │
│  │  logs/market-b_2026-01-18.json         │    │
│  │  logs/market-c_2026-01-18.json         │    │
│  └────────────────────────────────────────┘    │
└─────────────────────────────────────────────────┘
```

## Особенности реализации

### Многопоточность
- Каждый рынок мониторится в отдельном потоке
- Thread-safe операции с конфигурацией (Lock)
- Graceful shutdown всех потоков

### Горячая перезагрузка
- Отдельный поток проверяет изменения файла
- Определение добавленных/удаленных рынков
- Запуск новых мониторов без остановки существующих

### Обработка ошибок
- Переподключение при сбое API
- Продолжение работы при ошибках записи
- Логирование всех ошибок

### Ротация файлов
- Автоматическое создание новых файлов каждый день
- Формат имени с датой
- Сохранение истории

## Расширение функционала

### Добавление нового источника данных

1. Добавить функцию получения данных в `price_monitor_service.py`
2. Вызвать её в методе `MarketMonitor.run()`
3. Обновить структуру `log_entry`

### Добавление уведомлений

1. Установить библиотеку (например, `python-telegram-bot`)
2. Добавить в конфиг параметры уведомлений
3. Вызывать функцию уведомления при определенных событиях

### Добавление базы данных

1. Установить драйвер БД (например, `psycopg2`)
2. Заменить `log_price()` на запись в БД
3. Добавить параметры подключения в конфиг

## Лицензия и вклад

Проект создан для личного использования. Вы можете свободно модифицировать код под свои нужды.
